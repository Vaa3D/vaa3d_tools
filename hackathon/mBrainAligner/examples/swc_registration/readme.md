
![swc_reg_example_1](https://github.com/Vaa3D/vaa3d_tools/blob/master/hackathon/mBrainAligner/doc/images_swc_reg/image-20210805143056992.png)

Registration of neuron reconstructions is important for comparative studies across cell-types and samples. Here, we introduce a step-by-step manual for registration of reconstruction data, in SWC format. You will need the deformation field files generated by the “brain image registration” step.

### SWC registration pipeline--windows version

#### Step 1: Modify the file path and the brain size in "example/run_swc_warp.bat". (The following table describes the parameters)

Please modify the path of each file in ".bat ", input the original image and resample image size, and modify the template brain size if necessary (default [568,320,456]). The meanings of each parameter are as follows.

<the path to input file>
  
-C <input_CCF_marker>  input _RPM_tar.marker file full name.

-M <input_Manual_marker>	input _RPM_sub.marker file full name.

-o <input_original_swc>	input original swc file full name.

-T <input_tar_auto_marker>  input ori_local_registered_tar.marker file full name.

-S <input_brain_auto_marker>     input ori_local_registered_sub.marker file full name.

-d <input_FFD_grid>  input _FFD_grid.swc file full name. If FFD is included in the brain registration, add it.

-w <Newton's optimization>  swc number -1,0,1,2......,w=0;or w=1.

<the size to original brain image>
  
-X <original image size_x>   input original brain image size_x.

-Y <original image size_y>   input original brain image size_y.

-Z <original image size_z>   input original brain image size_z.

<the size to resample or stripmove brain image>
  
-x <resample image size_x>   input resample brain image size_x.

-y <resample image size_y>   input resample brain image size_y.

-z <resample image size_z>   input resample brain image size_z.

<the size to template brain image,default [568 320 456], is "average_template_25_u8_xpad.v3draw", an Allen CCF brain>
  
-a <average_template image size_x>   input average_template brain image size_x.

-b <average_template image size_y>   input average_template brain image size_y.

-c <average_template image size_z>   input average_template brain image size_z.

-p <pading_x>       input template brain xpad, if you don't want to keep it, default 20.

<the path to output swc file>
  
-r <out_resample_swc>    output resample_swc file full name.

-f <out_affine_swc>     output affine_swc file full name.

-s <out_stps_swc>     output stps_swc file full name, this is the end result.

#### Step 2: Double-click on "run_swc_warp.bat" to run.

### SWC registration pipeline--linux version  
#### Step 1: Modify the file path and the brain size in "example/run_swc_warp_linux.sh".   
#### Step 2: 

Ctrl+Alt+t to open terminal

    cd "(your file path)/binary/linux_bin/"
    tar xvJf lib.tar.xz
    sudo gedit /etc/ld.so.conf
    add the "(your file path)/binary/linux_bin/lib/"  to the last line of '/etc/ld.so.conf' and save.
    sudo ldconfig
    sudo chmod 777 -R  swc_registration
    cd "(your file path)/examples/"

Then run
    sh run_swc_warp_linux.sh  

### pipeline-registration
```
├────examples
│   ├──── sample_data
│   |  ├── original_data.swc
│   |  ├── raw_FFD_grid.swc
│   |  ├── raw_RPM_tar.marker
│   |  ├── raw_RPM_sub.marker
│   |  ├── ori_local_registered_sub.marker
│   |  └── ori_local_registered_tar.marker
|   ├──── result
│   ├──── run_swc_warp.bat
│   └──── run_swc_warp_linux.sh
└────binary
    ├──── linux_bin
    |  ├── lib.tar.xz
    |  └── swc_registration
    └───── win64_bin
       ├── Qt5Core.dll
       ├── Qt5Gui.dll
       ├── Qt5Widgets.dll
       └── swc_registration.exe     
```

